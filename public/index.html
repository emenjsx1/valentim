<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Checkout Seguro - Ferramenta Secreta</title>

<!-- Meta Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '4179716432354886');
  fbq('track', 'PageView');
</script>
<noscript>
  <img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=4179716432354886&ev=PageView&noscript=1"/>
</noscript>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  margin: 0; padding:0;
}
.header-timer{
  background-color: #d40000; color:#fff; text-align:center; font-weight:bold; padding:10px;
}
.container{
  max-width:400px; margin:30px auto; background:#fff; border-radius:12px; box-shadow:0 0 12px rgba(0,0,0,0.12); padding:20px;
}
.secure{display:flex; align-items:center; margin-bottom:10px; font-weight:bold;}
.country{text-align:right; font-size:14px; margin-top:-20px; margin-bottom:10px;}
.logo{text-align:center;}
.logo img{width:60px; border-radius:12px;}
.title{text-align:center; font-weight:bold; margin-top:10px; font-size:18px;}
.price{text-align:center; color:#0077cc; font-size:22px; font-weight:bold; margin-bottom:15px;}
.subprice{text-align:center; color:var(--muted); font-size:12px; margin-bottom:12px}

label{display:block; margin-top:10px; margin-bottom:5px; font-weight:bold;}
input[type="text"], input[type="email"]{
  width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; font-size:14px;
}
.payment-methods{display:flex; justify-content:space-between; margin-top:10px;}
.payment-methods button{
  flex:1; padding:10px; margin-right:10px; border:2px solid #ccc; background:#fff; cursor:pointer; border-radius:6px; font-weight:bold;
}
.payment-methods button:last-child{margin-right:0;}
.payment-methods .active{border-color:#d40000; background-color:#ffd6d6;}

.details{margin-top:20px; background:#f9fafb; border:1px solid #e5e7eb; padding:12px; border-radius:8px; font-size:14px;}
.details p{margin:4px 0;}

.buy-btn{
  margin-top:20px; background-color:#28a745; color:white; width:100%; padding:12px; font-size:16px; border:none; border-radius:6px; cursor:pointer; font-weight:bold;
}
.buy-btn:hover{background-color:#218838;}

/* Order Bump */
.order-bump{
  display:flex; align-items:flex-start; gap:10px; margin-top:18px;
  background:#fff1f0; border:1px solid #fecaca; border-radius:8px; padding:12px; cursor:pointer;
  font-size:14px;
}
.order-bump:hover{background:#fee2e2;}
.order-bump input{margin-top:3px; width:20px; height:20px;}
.order-bump .txt .t{font-weight:800; color:#b91c1c;}

#popup{
  display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;
}
#popup .modal{
  background:white; padding:20px; border-radius:10px; text-align:center; max-width:300px; animation:fadeIn 0.3s ease;
}
#contador{margin-top:10px; color:#555; font-size:14px;}
@keyframes fadeIn{from{opacity:0; transform:scale(0.9);} to{opacity:1; transform:scale(1);}}
</style>
</head>
<body>

<div class="header-timer">Oferta expira em 00:09:56</div>

<div class="container">
  <div class="secure">üîí COMPRA SEGURA</div>
  <div class="country">üá≤üáø</div>

  <div class="logo">
    <img src="https://cdn6.aptoide.com/imgs/c/7/d/c7d948849c24f1ce89149eeb38385af0_icon.png" alt="Logo do Produto">
  </div>

  <div class="title">Ferramenta Secreta</div>
  <div class="price" id="price">197,00 MT</div>
<div class="subprice">Produto digital ‚Äì entrega via WhatsApp ap√≥s confirma√ß√£o</div>

  <form id="formPagamento">
    <label for="nome">Nome completo</label>
    <input type="text" id="nome" name="nome" placeholder="Seu nome" required  />

    <label for="email">Email</label>
    <input type="email" id="email" name="email" placeholder="seu@email.com" required />

    <label>M√©todo de pagamento</label>
    <div class="payment-methods">
      <button type="button" data-metodo="mpesa" class="active">üì± M-Pesa</button>
      <button type="button" data-metodo="emola">üì≤ e-Mola</button>
    </div>

    <label for="numero">N√∫mero de pagamento</label>
    <input type="text" id="numero" name="telefone" placeholder="8xxxxxxxx" required minlength="9" maxlength="9" />

    <!-- Order Bump -->
    <div class="order-bump" id="orderBump">
      <input type="checkbox" id="bumpCheck">
      <div class="txt"><span class="t">Adicionar Comunidade VIP (+97 MT)</span><br>Acesso a conte√∫dos exclusivos e materiais b√¥nus.</div>
    </div>

    <div class="details">
      <p><strong>Detalhes da compra</strong></p>
      <p>Ferramenta Secreta</p>
      <p><strong>Order Bump:</strong> <span id="bumpLabel">N√£o</span></p>
      <p><strong>Total:</strong> <span id="totalFmt">197,00 MT</span></p>
    </div>

    <button type="submit" class="buy-btn">Comprar agora</button>
  </form>
</div>

<div id="popup">
  <div class="modal">
    <h3>üîê Processando pagamento...</h3>
    <p>Enviando pedido via <b><span id="metodoSelecionado"></span></b>.</p>
    <p>Aguarde a confirma√ß√£o ap√≥s digitar o PIN.</p>
    <p id="contador">Fechando em 180s...</p>
  </div>
</div>


<script>
const metodoBtns = document.querySelectorAll(".payment-methods button");
let metodoSelecionado = "mpesa";
let wallet_id = "";
let number_waht = "258824342006";
let push_cut ="https://api.pushcut.io/QsggCCih4K4SGeZy3F37z/notifications/MinhaNotifica%C3%A7%C3%A3o";
let acess_token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI5ZmNjODVlYy0wYTYzLTQ4ZDgtODYwMS1mZDI5MmExZTI4MTciLCJqdGkiOiI0ZmNkMmU3ZGU1NGNmZDY5ZDc1NmIxYTNjZGVmN2MyZjlmN2ViZmE0MTk1NzliNTNkY2E3M2VlYjdlZTVmMjA3ODBhMGQ3ZjdhMmJjZDZhZSIsImlhdCI6MTc1NzA5MTA0NS44MTk3MDUsIm5iZiI6MTc1NzA5MTA0NS44MTk3MTgsImV4cCI6MTc4ODYyNzA0NS44MTUwOTEsInN1YiI6IiIsInNjb3BlcyI6W119.EPLlbjMp3SLKU5eMGUoRj_yYg1cDYo8DJTGcoGWjuADBPBIJokQ2ytureG-m6lSfbFe-Zo1neUsYz4K7v6XNYvL_DKNdi_TYVM7mGbLssKkmViMR8_QPYrp2e-9fhbLlvmH23C6TbKeUeSdwzbeZl1FyQMmCbTdSAGGrO8dT1sy64TKKGeHzwFTrF-9enUBy_hZrtPbss2NGiO1Flx52XeJ-HUQd-hTlNMeuhpwuBAwgPXzSzthbUtz4ETMAVLBSxo7Kth00iZif6bBjiT6LYx4Miss76ChTpxy-lbFCFkkU6Jj7Ao6ASVjFhYQ_xaEkXKp1F8dvoJACxN3C_eOBXJx84Tfx75jr6obM1uTziVbGVGn8I5gkX_JmD1eEilhLEFF_75nP549mXmCiSVIzSpNnOCTt5Ufmp6-vCv5r5pRi4jvGn6rE6uoH2Und5hoS8_9Dw8Oac4rpJw3ZqbBLtnI5zcuyM0zIbkj7SYbCiKMX0Gq_sZlOG_u8i5KFP_VP-aRDbFMQew6PonCr_veV9wnRnQLTVug4t5a57zAAcqAeUqWAgveS4Tx6tpKAJeVdovdsVG3NFo8EL7yLAj53gpYOUn2YsivG_oYNTRgdEKlSb9nJGYw4m3LT4lfXjaOMtnt5GbofjfWVTf8k4UlLpfEgtK5itMfD78zoWZVtELE";

metodoBtns.forEach(btn => {
  btn.addEventListener("click", () => {
    metodoBtns.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    metodoSelecionado = btn.dataset.metodo;
  });
});

const vipCheckbox = document.getElementById("bumpCheck");
const totalFmtEl = document.getElementById("totalFmt");
const bumpLabelEl = document.getElementById("bumpLabel");
const PRICE_BASE = 197;
const PRICE_BUMP = 97;

vipCheckbox.addEventListener("change",()=>{
  const total = PRICE_BASE + (vipCheckbox.checked ? PRICE_BUMP : 0);
  totalFmtEl.textContent = total.toLocaleString('pt-MZ',{style:'currency', currency:'MZN'});
  bumpLabelEl.textContent = vipCheckbox.checked ? "Sim (+97 MT)" : "N√£o";
});

fbq('track','InitiateCheckout');

document.getElementById("formPagamento").addEventListener("submit", async function(e) {
  e.preventDefault();

  const nome = document.getElementById("nome").value;
  const email = document.getElementById("email").value;
  const telefone = document.getElementById("numero").value;
  if (!nome || !email || !telefone || !metodoSelecionado) throw new Error('Dados incompletos');
  if (!/^(84|85|86|87)\d{7}$/.test(telefone)) throw new Error('Numero de telefone invalido');

  const popup = document.getElementById("popup");
  popup.style.display = "flex";

  let tempo = 180;
  const interval = setInterval(() => {
    document.getElementById("contador").innerText = `Fechando em ${tempo--}s...`;
    if (tempo < 0) clearInterval(interval);
  }, 1000);

  wallet_id = metodoSelecionado==='mpesa'?"993735":"993734";

  try {
    const resposta = await fetch(`https://mpesaemolatech.com/v1/c2b/${metodoSelecionado}-payment/${wallet_id}`,{
      method: "POST",
      headers: {
         "Authorization": `Bearer ${acess_token}`,
         "Accept": "application/json",
         "Content-Type": "application/json"
        },
      body: JSON.stringify({
          "client_id": "9fcc85ec-0a63-48d8-8601-fd292a1e2817",
          "amount": PRICE_BASE + (vipCheckbox.checked ? PRICE_BUMP : 0),
          "phone": telefone,
          "reference": "PrimeiroPagamento"
      })
    });
    if(resposta.status===200){
      try{ await fetch(push_cut,{method:'POST',body:JSON.stringify({text:`${nome} pagou ${PRICE_BASE + (vipCheckbox.checked ? PRICE_BUMP : 0)} MZN por ${metodoSelecionado}`,title:'Nova venda aprovada'})}); }catch(err){}
      let mensagem = `Comprei o produto Ferramenta Secreta e quero o receber, meu nome √© ${nome}, paguei usando o ${metodoSelecionado} pelo numero: ${telefone}`;
      let link = `https://wa.me/${number_waht}?text=` + encodeURIComponent(mensagem);
      fbq('track', 'Purchase', {
        value: PRICE_BASE + (vipCheckbox.checked ? PRICE_BUMP : 0),
        currency: 'MZN',
        content_name: 'Ferramenta Secreta',
        content_category: metodoSelecionado
      });
      window.location.href = link;
    } else {
      throw new Error("Pagamento n√£o foi processado");
      setTimeout(()=>{window.location.reload()},2000);
    }
  } catch(error){
    throw new Error("Pagamento n√£o foi processado");
    setTimeout(()=>{window.location.reload()},2000);
  }
});
</script>

</body>
</html>
